% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/placebo.R
\name{placebo}
\alias{placebo}
\title{Placebo significance level.}
\usage{
placebo(
  fm,
  df,
  splines,
  pc_num,
  nSim = 1000,
  weights = FALSE,
  max_clus = 6,
  Parallel = FALSE,
  exact_cholesky = TRUE,
  k_medoids = TRUE,
  jitter_coords = TRUE
)
}
\arguments{
\item{fm}{The equation formula. The variable of interest should be the first
one on the right hand side.}

\item{df}{The name of the dataset use. Longitude and latitude must be named
\code{X} and \code{Y} and have no missing values. Weighting variables, if used, must be
named \code{weights}.}

\item{splines}{The dimension of the linear tensor used, from \code{\link[=optimal_basis]{optimal_basis()}}
function.}

\item{pc_num}{The number of principal component to include, again from
optimal_basis function.}

\item{nSim}{The number of placebos to generate. Defaults to 1000 but lower
values should be used first to get an idea of how the regression is
behaving.}

\item{weights}{Set \code{weights=TRUE} if the regression is weighted. The weighting
variable in the dataset must be named \code{weights}.}

\item{max_clus}{The maximum number of large cluster standard errors to examine
with the placebo test. Defaults to 6.}

\item{Parallel}{Run the simulations in parallel.}

\item{exact_cholesky}{For very large datasets, setting this to \code{FALSE} will use
the \code{BRISC} Cholesky approximation.}

\item{k_medoids}{For large datasets, set to \code{FALSE} to use Clara to generate
medoids.}

\item{jitter_coords}{If some sites have identical coordinates, jitter by
adding Gaussian noise with standard deviation of 0.01 (10 km) to allow a
Moran test to be calculated.}
}
\value{
A list containing \code{Results} which summarizes the placebo values and
\code{Spatial_Params} giving the Moran test value and the range and structure
used to generate the placebos. Choose the number of clusters where the
proportion of placebo regressions significant at 5\% is in the region of
0.05 to 0.07.
}
\description{
\code{placebo()} runs a spatial noise placebo test on a regression to choose
the optimal number of large clusters for BCH standard errors and obtain the
placebo significance level of the treatment variable. The placebo matches
the spatial trends of the explanatory variable by regressing it on the
principal components chosen by \code{\link[=spatial_basis]{spatial_basis()}} and then simulates noise
with the same correlation structure as the residuals from that regression.
For each number of clusters it gives the regression and placebo significance
levels.
}
\examples{
library(spatInfer)
data(opportunity)
# Use 100 observations and 100 simulations to speed things up.
set.seed(123)
opportunity=opportunity |> dplyr::slice_sample(n=100)
# Use the number of splines and PCs indicated by [optimal_basis()].
plbo_bch=placebo(mobility~racial_seg+single_mom,  opportunity,
splines=4, pc_num=3,nSim=100, Parallel=FALSE)    #Turn Parallel on to speed up.

placebo_table(plbo_bch,adjust="BCH")
}
